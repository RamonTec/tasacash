{"version":3,"sources":["../src/modules/request.js"],"names":["query","j","currency","length","console","log","enlace","instancia","LocalBitcoin","consulta","request","then","result","undefined","i","results","data","save","err","order","object","obj","sort","a","b","date","coin","ordened","forEach","unixEpochTimeMS","d","Date","strDate","toLocaleString","tid","res","rates","price","amount","epoch"],"mappings":"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","sourcesContent":["import { currency, searchTid } from \"../models/currency.js\";\r\nimport { LocalBitcoin } from \"../modules/unaunth.js\";\r\n\r\nexport function query(j) {\r\n  let currency = [\"ves\", \"usd\", \"eur\", \"rub\", \"cny\"];\r\n\r\n  if (j <= currency.length - 1) {\r\n    console.log(currency[j]);\r\n    let enlace = `/bitcoincharts/${currency[j]}/trades.json`;\r\n    console.log(enlace);\r\n    let instancia = new LocalBitcoin(enlace);\r\n    const consulta = instancia.request(enlace);\r\n\r\n    consulta\r\n      .then(async result => {\r\n        if (result !== undefined) {\r\n          let i = 0;\r\n          const results = result.data;\r\n          console.log(currency.length);\r\n          save(results, i, currency[j]);\r\n          j++;\r\n          query(j);\r\n        }\r\n      })\r\n      .catch(err => {\r\n        console.log(err);\r\n      });\r\n  }\r\n}\r\n\r\nexport function order(results) {\r\n  const object = results;\r\n  const obj = object.sort(function(a, b) {\r\n    if (a.date > b.date) {\r\n      return 1;\r\n    }\r\n    if (a.date < b.date) {\r\n      return -1;\r\n    }\r\n\r\n    return 0;\r\n  });\r\n\r\n  return obj;\r\n}\r\n\r\nexport function save(results, i, coin) {\r\n  let ordened = 0;\r\n  if (i <= results.length - 1) {\r\n    ordened = order(results);\r\n\r\n    ordened.forEach(ordened => {\r\n      const unixEpochTimeMS = ordened.date * 1000;\r\n      const d = new Date(unixEpochTimeMS);\r\n      const strDate = d.toLocaleString();\r\n\r\n      searchTid(ordened.tid, coin)\r\n        .then(async res => {\r\n          if (res == 1) {\r\n            const rates = new currency({\r\n              tid: ordened.tid,\r\n              currency: coin,\r\n              price: ordened.price,\r\n              amount: ordened.amount,\r\n              date: strDate,\r\n              epoch: ordened.date\r\n            });\r\n            await rates.save();\r\n          }\r\n        })\r\n        .catch(err => {\r\n          console.log(err);\r\n        });\r\n    });\r\n  }\r\n}\r\n"],"file":"request.js"}